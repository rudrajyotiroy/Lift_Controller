name: Multi-Lift Controller Simulation

on:
  push:
    branches: [ main, multi-elevator-support, multi-elevator-support-v2 ]
  pull_request:
    branches: [ main ]

jobs:
  simulate:
    runs-on: self-hosted # Requires a runner with Vivado installed

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run Vivado Simulation
        run: |
          cd vivado_sim/xsim
          chmod +x lift_controller_tb_top.sh
          ./lift_controller_tb_top.sh > sim_output.log 2>&1

      - name: Verify Results
        run: |
          cd vivado_sim/xsim
          cat sim_output.log
          if grep -q "TEST CASE PASSED" sim_output.log; then
            echo "Simulation Successful"
            exit 0
          else
            echo "Simulation Failed or 'TEST CASE PASSED' not found"
            exit 1
          fi
